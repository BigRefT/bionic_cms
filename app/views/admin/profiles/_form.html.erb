<% field_set_tag "#{save_label} Profile" do -%>
  <% @user = @profile.user %>
  <% render_region :form_top, :locals => { :f => f } do |form_top| %>
    <% form_top.edit_errors do %>
      <%= error_messages_for :profile, :user, :object_name => 'account' %>
    <% end %>
  <% end %>
  <% render_region :form, :locals => { :f => f } do |form| %>
    <% form.edit_email do %>
      <%= f.text_field :email, :label => "Email:", :required => true %>
    <% end %>
    <% form.edit_email_confirmation do %>
      <%= f.text_field :email_confirmation, :label => "Email Confirmation:", :required => true if @profile.new_record?%>
    <% end %>
    <% form.edit_first_name do %>
      <%= f.text_field :first_name, :label => "First Name:", :required => true %>
    <% end %>
    <% form.edit_last_name do %>
      <%= f.text_field :last_name, :label => "Last Name:", :required => true %>
    <% end %>
    <% form.edit_user_fields do %>
      <%= render :partial => 'user_fields', :locals => { :f => f } if @profile.has_account? %>
    <% end %>
  <% end %>
  <% render_region :form_bottom, :locals => { :f => f } do |form_bottom| %>
    <% form_bottom.edit_buttons do %>
      <%= f.submit_or_back save_label, admin_profiles_path %>
    <% end %>
  <% end %>
<% end -%>